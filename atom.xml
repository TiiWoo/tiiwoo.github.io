<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>TiiWoo's Blog</title>
        <link>https://tiiwoo.github.io/TiiWoo.github.io</link>
        <description>å–œæ¬¢ç©</description>
        <lastBuildDate>Sat, 06 Feb 2021 14:19:35 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>Gridsome Feed Plugin</generator>
        <atom:link href="https://tiiwoo.github.io/TiiWoo.github.io/atom.xml" rel="self" type="application/rss+xml"/>
        <item>
            <title><![CDATA[P3368 ã€æ¨¡æ¿ã€‘æ ‘çŠ¶æ•°ç»„ 2]]></title>
            <link>https://tiiwoo.github.io/TiiWoo.github.io/posts/fenwick-tree-2/</link>
            <guid>https://tiiwoo.github.io/TiiWoo.github.io/posts/fenwick-tree-2/</guid>
            <pubDate>Sat, 06 Feb 2021 00:00:00 GMT</pubDate>
            <content:encoded><![CDATA[<h3 id="é¢˜ç›®">é¢˜ç›®</h3>
<p>[^1]</p>
<h4 id="é¢˜ç›®æè¿°">é¢˜ç›®æè¿°</h4>
<p>å¦‚é¢˜ï¼Œå·²çŸ¥ä¸€ä¸ªæ•°åˆ—ï¼Œä½ éœ€è¦è¿›è¡Œä¸‹é¢ä¸¤ç§æ“ä½œï¼š</p>
<ol>
<li>å°†æŸåŒºé—´æ¯ä¸€ä¸ªæ•°æ•°åŠ ä¸Š $x$ï¼›</li>
<li>æ±‚å‡ºæŸä¸€ä¸ªæ•°çš„å€¼ã€‚<!--more-->
<h4 id="è¾“å…¥æ ¼å¼">è¾“å…¥æ ¼å¼</h4>
</li>
</ol>
<p>ç¬¬ä¸€è¡ŒåŒ…å«ä¸¤ä¸ªæ•´æ•° $N$ã€$M$ï¼Œåˆ†åˆ«è¡¨ç¤ºè¯¥æ•°åˆ—æ•°å­—çš„ä¸ªæ•°å’Œæ“ä½œçš„æ€»ä¸ªæ•°ã€‚</p>
<p>ç¬¬äºŒè¡ŒåŒ…å« $N$ ä¸ªç”¨ç©ºæ ¼åˆ†éš”çš„æ•´æ•°ï¼Œå…¶ä¸­ç¬¬ $i$ ä¸ªæ•°å­—è¡¨ç¤ºæ•°åˆ—ç¬¬ $i$ é¡¹çš„åˆå§‹å€¼ã€‚</p>
<p>æ¥ä¸‹æ¥ $M$è¡Œæ¯è¡ŒåŒ…å« 2 æˆ– 4 ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºä¸€ä¸ªæ“ä½œï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p>
<p>æ“ä½œ 1ï¼š æ ¼å¼ï¼š<code>1 x y k</code> å«ä¹‰ï¼šå°†åŒºé—´ $x,y$ å†…æ¯ä¸ªæ•°åŠ ä¸Š $k$ï¼›</p>
<p>æ“ä½œ 2ï¼š æ ¼å¼ï¼š<code>2 x</code> å«ä¹‰ï¼šè¾“å‡ºç¬¬ $x$ ä¸ªæ•°çš„å€¼ã€‚</p>
<h4 id="è¾“å‡ºæ ¼å¼">è¾“å‡ºæ ¼å¼</h4>
<p>è¾“å‡ºåŒ…å«è‹¥å¹²è¡Œæ•´æ•°ï¼Œå³ä¸ºæ‰€æœ‰æ“ä½œ 2 çš„ç»“æœã€‚</p>
<h4 id="è¾“å…¥è¾“å‡ºæ ·ä¾‹">è¾“å…¥è¾“å‡ºæ ·ä¾‹</h4>
<p><strong>è¾“å…¥ #1</strong></p>
<pre><code class="language-text">5 5
1 5 4 2 3
1 2 4 2
2 3
1 1 5 -1
1 3 5 7
2 4</code></pre>
<p><strong>è¾“å‡º #1</strong></p>
<pre><code class="language-text">6
10</code></pre>
<h4 id="è¯´æ˜æç¤º">è¯´æ˜/æç¤º</h4>
<h5 id="æ ·ä¾‹-1-è§£é‡Šï¼š">æ ·ä¾‹ 1 è§£é‡Šï¼š</h5>
<p><img src="https://rmt.dogedoge.com/fetch/royce/storage/fenwick-tree-2/01.png?fmt=webp" alt="è§£é‡Š"></p>
<p>æ•…è¾“å‡ºç»“æœä¸º 6ã€10ã€‚</p>
<hr>
<h5 id="æ•°æ®è§„æ¨¡ä¸çº¦å®š">æ•°æ®è§„æ¨¡ä¸çº¦å®š</h5>
<p>å¯¹äº $30%$ çš„æ•°æ®ï¼š$N\le8,M\le10$ï¼›</p>
<p>å¯¹äº $70%$ çš„æ•°æ®ï¼š$N\le 10000,M\le10000$ï¼›</p>
<p>å¯¹äº $100%$ çš„æ•°æ®ï¼š$1 \leq N, M\le 500000$ï¼Œ$1 \leq x, y \leq n$ï¼Œä¿è¯ä»»æ„æ—¶åˆ»åºåˆ—ä¸­ä»»æ„å…ƒç´ çš„ç»å¯¹å€¼éƒ½ä¸å¤§äº $2^{30}$ã€‚</p>
<h3 id="é¢˜è§£">é¢˜è§£</h3>
<p>ä¸Šä¸€ç¯‡æ–‡ç« å·²ç»è®²äº†<code>æ ‘çŠ¶æ•°ç»„ 1</code>ï¼Œå•ç‚¹ä¿®æ”¹åŒºé—´æŸ¥è¯¢ã€‚</p>
<p>æ ‘çŠ¶æ•°ç»„ 2 éœ€è¦å®ç°çš„æ˜¯åŒºé—´ä¿®æ”¹ï¼Œå•ç‚¹æŸ¥è¯¢ã€‚</p>
<p>å¹¶ä¸”æ ‘çŠ¶æ•°ç»„ 2 è¦å®Œå…¨ä¾èµ–äºæ ‘çŠ¶æ•°ç»„ 1ï¼Œä»…åœ¨ 1 çš„åŸºç¡€ä¸Šå¼•å…¥å·®åˆ†æ•°ç»„</p>
<p>é€šè¿‡å·®åˆ†æ•°ç»„å°†å…¶è½¬æ¢ä¸ºå•ç‚¹ä¿®æ”¹åŒºé—´æŸ¥è¯¢ï¼Œæ²¡é”™ï¼Œå°±æ˜¯æ ‘çŠ¶æ•°ç»„ 1ï¼Œçš„å•ç‚¹ä¿®æ”¹åŒºé—´æŸ¥è¯¢</p>
<h4 id="å‰ç½®çŸ¥è¯†-å·®åˆ†æ•°ç»„">å‰ç½®çŸ¥è¯† å·®åˆ†æ•°ç»„</h4>
<p>ç°æœ‰ä¸€åºåˆ— $A$
$$
A={3,,1,,4,,1,,5,,9,,2,,6,,5}
$$
å»ºç«‹ä¸€ä¸ªå·®åˆ†æ•°ç»„ $D$, ä½¿å¾— $D_i=A_i-A_{i-1}$
$$
D={3,;-2,,3,,-3,,4,,4,,-7,,4,,-1}
$$</p>
<p>æ­¤æ—¶å°† $A$ åºåˆ—ä¸­ $A_3 \sim A_5$ éƒ½åŠ ä¸Š 3ï¼Œå¾—åˆ°æ–°çš„ $A$
$$
A={3,,1,,7,,4,,8,,9,,2,,6,,5}
$$
æ­¤æ—¶å†æ›´æ–° $D$ æ•°ç»„
$$
D={3,,-2,,6,,-3,,4,,1,,-7,,4,,-1}
$$
ä¸éš¾å‘ç°ï¼Œåœ¨ $A$ åºåˆ—çš„ $A_i \sim A_j$ åŒºé—´åˆ†åˆ«åŠ ä¸Š $n$ ï¼Œåœ¨å·®åˆ†æ•°ç»„ $D$ ä¸­å°±ç›¸å½“äº $D_i;+=; n,;D_{j+1};-=;n$</p>
<p>ç›¸ä¿¡èªæ˜çš„ä½ å·²ç»å‘ç°äº†ï¼Œè¿™é‡Œå‡ºç°äº†æ ‘çŠ¶æ•°ç»„ 1çš„å•ç‚¹ä¿®æ”¹</p>
<h4 id="æŸ¥è¯¢">æŸ¥è¯¢</h4>
<p>è¿™ä¸ªä¹Ÿå°±å˜çš„å¾ˆç®€å•äº†ï¼Œåˆ©ç”¨å·®åˆ†æ•°ç»„çš„æ€§è´¨ï¼Œå‡è®¾æˆ‘ä»¬è¦æ±‚ $A_3$</p>
<p>é‚£ä¹ˆ</p>
<p>$$
A_3=D_1+D_2+D_3
$$
å¥½å•¦ï¼Œå°±æ˜¯è¿™ä¹ˆç®€å•</p>
<h3 id="ç»“æŸ">ç»“æŸ</h3>
<p>é™„ä¸Š AC ä»£ç </p>
<pre><code class="language-cpp">#include &lt;cstdio&gt;

int n,m,k,x,aa,l,r;
int a[500110],c[500110];

int read() {
    bool flag = 1;
    int x = 0;
    char ch = getchar();
    while (ch&lt;&#39;0&#39; || ch&gt;&#39;9&#39;) {if (ch == &#39;-&#39;) flag = 0; ch = getchar();}
    while (ch&gt;=&#39;0&#39; &amp;&amp; ch&lt;=&#39;9&#39;) {x *= 10;x += ch-&#39;0&#39;;ch=getchar();}
    return flag ? x:-x;
}
int lowbit(int x) {
    return x &amp; -x;
}
void add(int x,int k) {
    while (x&lt;=n) {
        c[x] += k;
        x += lowbit(x);
    }
}
int find(int x) {
    int sum = 0;
    while (x) {
        sum += c[x];
        x -= lowbit(x);
    }
    return sum;
}

int main() {
    n = read(); m = read();
    for (int i=1; i&lt;=n; i++) {
        a[i] = read();
        add(i, a[i]-a[i-1]);
    }
    while (m--) {
        aa = read();
        if (aa==1) {
            l = read(); r = read(); k =read();
            add(l,k);
            add(r+1,-k);
        }
        else {
            k = read();
            printf(&quot;%d\n&quot;, find(k));
        }
    }
    return 0;
}</code></pre>
<p>[^1]: é¢˜ç›®æ¥æºï¼š<a href="https://www.luogu.com.cn/problem/P3368">P3368 ã€æ¨¡æ¿ã€‘æ ‘çŠ¶æ•°ç»„ 2 - æ´›è°· | è®¡ç®—æœºç§‘å­¦æ•™è‚²æ–°ç”Ÿæ€</a></p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Hello World]]></title>
            <link>https://tiiwoo.github.io/TiiWoo.github.io/posts/hello-world/</link>
            <guid>https://tiiwoo.github.io/TiiWoo.github.io/posts/hello-world/</guid>
            <pubDate>Sat, 06 Feb 2021 00:00:00 GMT</pubDate>
            <content:encoded><![CDATA[<p>æˆ‘çš„åšå®¢è¯ç”Ÿäº†ï¼</p>
<p>$1+1=2$
$$
Hello; World
$$</p>
<pre><code class="language-cpp">#include &lt;iostream&gt;
using namespace std;

int main() 
{
    cout &lt;&lt; &quot;ä½ å¥½ä¸–ç•Œ&quot; &lt;&lt; endl;
    cout &lt;&lt; &quot;Hello World&quot; &lt;&lt; endl;
    return 0;
}</code></pre>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[P3372 ã€æ¨¡æ¿ã€‘çº¿æ®µæ ‘ 1]]></title>
            <link>https://tiiwoo.github.io/TiiWoo.github.io/posts/segment-tree-1/</link>
            <guid>https://tiiwoo.github.io/TiiWoo.github.io/posts/segment-tree-1/</guid>
            <pubDate>Sat, 06 Feb 2021 00:00:00 GMT</pubDate>
            <content:encoded><![CDATA[<h2 id="é¢˜ç›®">é¢˜ç›®</h2>
<h3 id="é¢˜ç›®æè¿°">é¢˜ç›®æè¿°</h3>
<p>å¦‚é¢˜ï¼Œå·²çŸ¥ä¸€ä¸ªæ•°åˆ—ï¼Œä½ éœ€è¦è¿›è¡Œä¸‹é¢ä¸¤ç§æ“ä½œï¼š</p>
<ol>
<li>å°†æŸåŒºé—´æ¯ä¸€ä¸ªæ•°åŠ ä¸ŠÂ $k$ã€‚</li>
<li>æ±‚å‡ºæŸåŒºé—´æ¯ä¸€ä¸ªæ•°çš„å’Œã€‚</li>
</ol>
<h3 id="è¾“å…¥æ ¼å¼">è¾“å…¥æ ¼å¼</h3>
<p>ç¬¬ä¸€è¡ŒåŒ…å«ä¸¤ä¸ªæ•´æ•°Â $n, m$ï¼Œåˆ†åˆ«è¡¨ç¤ºè¯¥æ•°åˆ—æ•°å­—çš„ä¸ªæ•°å’Œæ“ä½œçš„æ€»ä¸ªæ•°ã€‚</p>
<p>ç¬¬äºŒè¡ŒåŒ…å«Â $n$Â ä¸ªç”¨ç©ºæ ¼åˆ†éš”çš„æ•´æ•°ï¼Œå…¶ä¸­ç¬¬Â $i$Â ä¸ªæ•°å­—è¡¨ç¤ºæ•°åˆ—ç¬¬Â $i$Â é¡¹çš„åˆå§‹å€¼ã€‚</p>
<p>æ¥ä¸‹æ¥Â $m$Â è¡Œæ¯è¡ŒåŒ…å«Â $3$Â æˆ–Â $4$Â ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºä¸€ä¸ªæ“ä½œï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p>
<ol>
<li><code>1 x y k</code>ï¼šå°†åŒºé—´Â $[x, y]$Â å†…æ¯ä¸ªæ•°åŠ ä¸ŠÂ $k$ã€‚</li>
<li><code>2 x y</code>ï¼šè¾“å‡ºåŒºé—´Â $[x,y]$Â å†…æ¯ä¸ªæ•°çš„å’Œã€‚</li>
</ol>
<h3 id="è¾“å‡ºæ ¼å¼">è¾“å‡ºæ ¼å¼</h3>
<p>è¾“å‡ºåŒ…å«è‹¥å¹²è¡Œæ•´æ•°ï¼Œå³ä¸ºæ‰€æœ‰æ“ä½œ 2 çš„ç»“æœã€‚</p>
<h3 id="è¾“å…¥è¾“å‡ºæ ·ä¾‹">è¾“å…¥è¾“å‡ºæ ·ä¾‹</h3>
<p><strong>è¾“å…¥ #1</strong></p>
<pre><code class="language-text">5 5
1 5 4 2 3
2 2 4
1 2 3 2
2 3 4
1 1 5 1
2 1 4</code></pre>
<p><strong>è¾“å‡º #1</strong></p>
<pre><code class="language-text">11
8
20</code></pre>
<h3 id="è¯´æ˜æç¤º">è¯´æ˜/æç¤º</h3>
<p>å¯¹äºÂ $30%$Â çš„æ•°æ®ï¼š$n \le 8$ï¼Œ$m \le 10$ã€‚<br>å¯¹äºÂ $70%$ çš„æ•°æ®ï¼š$n \le {10}^3$ï¼Œ$m \le {10}^4$ã€‚<br>å¯¹äºÂ $100%$Â çš„æ•°æ®ï¼š$1 \le n, m \le {10}^5$ã€‚</p>
<p>ä¿è¯ä»»æ„æ—¶åˆ»æ•°åˆ—ä¸­ä»»æ„å…ƒç´ çš„å’Œåœ¨Â $[-2^{63}, 2^{63})$Â å†…ã€‚</p>
<p><strong>ã€æ ·ä¾‹è§£é‡Šã€‘</strong></p>
<p><img src="https://rmt.dogedoge.com/fetch/royce/storage/2024/01.png?fmt=webp" alt="æ ·ä¾‹è§£é‡Š"></p>
<h2 id="é¢˜è§£">é¢˜è§£</h2>
<p>:::tip
æƒ³è®¤çœŸå­¦æ¨èçœ‹çœ‹è¿™ç¯‡ä¸¤ç¯‡</p>
<p><a href="https://www.cnblogs.com/TheRoadToTheGold/p/6254255.html">æµ…è°ˆçº¿æ®µæ ‘ - TRTTG - åšå®¢å›­</a>
<a href="https://oi-wiki.org/ds/seg/">çº¿æ®µæ ‘ - OI Wiki</a>
:::</p>
<h3 id="å»ºæ ‘">å»ºæ ‘</h3>
<p>ä¸€ç›´äºŒåˆ†ï¼Œç›´åˆ° åˆ°äº†å¶å­èŠ‚ç‚¹ï¼Œè¾“å…¥æ•°æ®ï¼Œ==è®°ä½ return==</p>
<p>éå¶å­èŠ‚ç‚¹çš„å€¼ä¸º å·¦å„¿å­+å³å„¿å­</p>
<pre><code class="language-cpp">// å»ºæ ‘ï¼Œk å½“å‰èŠ‚ç‚¹
void build(LL l, LL r, LL k) {
    LL mid = (l + r) / 2;
    tree[k].l = l, tree[k].r = r;
    if (l == r) { // åˆ¤æ–­å¶å­èŠ‚ç‚¹
        tree[k].w = read();
        return;
    }
    build(l, mid, 2*k);
    build(mid+1, r, 2*k+1);
    tree[k].w = tree[2*k].w + tree[2*k+1].w;
}</code></pre>
<h3 id="æ‡’æ ‡è®°">æ‡’æ ‡è®°</h3>
<blockquote>
<p>A æœ‰ä¸¤ä¸ªå„¿å­ï¼Œä¸€ä¸ªæ˜¯ Bï¼Œä¸€ä¸ªæ˜¯ Cã€‚</p>
<p>æœ‰ä¸€å¤© A è¦å»ºä¸€ä¸ªæ–°æˆ¿å­ï¼Œæ²¡é’±ã€‚åˆšå¥½è¿‡å¹´å˜›ï¼Œæœ‰äººè¦ç»™ B å’Œ C çº¢åŒ…ï¼Œä¸¤ä¸ªçº¢åŒ…çš„é’±æ•°ç›¸åŒéƒ½æ˜¯Â $1$Â å…ƒï¼Œç„¶è€Œå› ä¸º A æ˜¯çˆ¶äº²æ‰€ä»¥çº¢åŒ…è‚¯å®šæ˜¯å…ˆå¡ç»™ A å’¯~</p>
<p>ç†è®ºä¸Šæ¥è®² A åº”è¯¥æŠŠä¸¤ä¸ªçº¢åŒ…åˆ†åˆ«ç»™ B å’Œ Cï¼Œä½†æ˜¯â€¦â€¦ç¼ºé’±å˜›ï¼ŒA å°±æŠŠçº¢åŒ…å·å·æ”¶åˆ°è‡ªå·±å£è¢‹é‡Œäº†ã€‚</p>
<p>A é«˜å…´åœ°è¯´ï¼šã€Œæˆ‘ç°åœ¨æœ‰Â $2$Â ä»½çº¢åŒ…äº†ï¼æˆ‘åˆå¤šäº†Â $2 \times 1 = 2$Â å…ƒäº†ï¼å“ˆå“ˆå“ˆ~ã€</p>
<p>ä½†æ˜¯ A çŸ¥é“ï¼Œå¦‚æœä»–ä¸æŠŠçº¢åŒ…ç»™ B å’Œ Cï¼Œé‚£ B å’Œ C è‚¯å®šä¼šä¸çˆ½ç„¶åå¯¼è‡´å®¶åº­çŸ›ç›¾æœ€åå´©æºƒï¼Œæ‰€ä»¥ A å¯¹å„¿å­ B å’Œ C è¯´ï¼šã€Œæˆ‘æ¬ ä½ ä»¬æ¯äººÂ $1$Â ä»½Â $1$Â å…ƒçš„çº¢åŒ…ï¼Œä¸‹æ¬¡æœ‰æ–°çº¢åŒ…ç»™è¿‡æ¥çš„æ—¶å€™å†ç»™ä½ ä»¬ï¼è¿™é‡Œæˆ‘å…ˆåšä¸‹è®°å½•â€¦â€¦å—¯â€¦â€¦æˆ‘æ¬ ä½ ä»¬å„Â $1$Â å…ƒâ€¦â€¦ã€</p>
<p>å„¿å­ Bã€C æœ‰ç‚¹æ¼æ€’ï¼šã€Œå¯æ˜¯å¦‚æœæœ‰åŒå­¦é—®èµ·æˆ‘ä»¬æˆ‘ä»¬æ”¶åˆ°äº†å¤šå°‘çº¢åŒ…å’‹åŠï¼Ÿä½ æŠŠæˆ‘ä»¬çš„çº¢åŒ…éƒ½æ”¶äº†ï¼Œæˆ‘ä»¬è¿˜æ€ä¹ˆè£…ï¼Ÿã€</p>
<p>çˆ¶äº² A èµ¶å¿™è¯´ï¼šã€Œæœ‰åŒå­¦é—®èµ·æ¥æˆ‘å°±ä¼šç»™ä½ ä»¬çš„ï¼æˆ‘æ¬ æ¡éƒ½å†™å¥½äº†ä¸ä¼šä¸ç®—è¯çš„ï¼ã€</p>
<p>è¿™æ · Bã€C æ‰æ”¾äº†å¿ƒã€‚[^2]</p>
</blockquote>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<p>è¦æ±‚ $4 \backsim 5$ çš„æ•°éƒ½åŠ ä¸Š $2$</p>
<p>é‚£ä¹ˆæˆ‘ä»¬ç°åœ¨åªéœ€è¦å°†å…¶çˆ¶äº²èŠ‚ç‚¹ $2$ çš„æ‡’æ ‡è®° $+2$</p>
<p>éœ€è¦ç”¨åˆ°çš„æ—¶å€™å°†æ‡’æ ‡è®°ä¸‹ä¼ ç»™å­èŠ‚ç‚¹</p>
<p>ä¸‹ä¼ æ“ä½œï¼š</p>
<ol>
<li><p>ä¸¤ä¸ªå­èŠ‚ç‚¹çš„æ‡’æ ‡è®°åˆ†åˆ«åŠ ä¸Šçˆ¶äº²èŠ‚ç‚¹çš„æ‡’æ ‡è®°çš„å€¼</p>
</li>
<li><p>å­èŠ‚ç‚¹çš„å€¼åˆ†åˆ«åŠ ä¸Š $(r-l+1) \times$ çˆ¶äº²èŠ‚ç‚¹çš„æ‡’æ ‡è®°å€¼ã€‚$(r-l+1)$ è¡¨ç¤ºè¯¥èŠ‚ç‚¹ä¹‹ä¸‹è¿˜æœ‰å¤šå°‘èŠ‚ç‚¹ï¼Œè¿™é‡Œå¿…é¡»ä¹˜çˆ¶äº²èŠ‚çš„æ‡’æ ‡è®°çš„å€¼ï¼Œè€Œä¸æ˜¯è‡ªå·±çš„æ‡’æ ‡è®°ï¼Œå› ä¸ºè‡ªèº«çš„æ‡’æ ‡è®°å¯èƒ½è¿˜åŒ…å«ä¸Šä¸€æ¬¡ä¸‹ä¼ çš„å€¼</p>
</li>
<li><p>çˆ¶äº²èŠ‚ç‚¹æ‡’æ ‡è®°å½’é›¶</p>
</li>
</ol>
<pre><code class="language-cpp">// æ‡’æ ‡è®°ä¸‹ä¼ ï¼Œk å½“å‰èŠ‚ç‚¹
void down(LL k) {
    tree[k * 2].f += tree[k].f;
    tree[k*2 + 1].f += tree[k].f;

    tree[k * 2].w += tree[k].f * (tree[k*2].r - tree[k*2].l + 1);
    tree[k*2 + 1].w += tree[k].f * (tree[k*2+1].r - tree[k*2+1].l + 1);

    tree[k].f = 0;
}</code></pre>
<h3 id="åŒºé—´ä¿®æ”¹">åŒºé—´ä¿®æ”¹</h3>
<p>$n = [l, r]$ éœ€è¦ä¿®æ”¹çš„åŒºé—´ï¼Œ$m = [s, t]$ å½“å‰åŒºé—´</p>
<p>$n, m$ åªæ»¡è¶³ä»¥ä¸‹ä¸‰ç§å…³ç³»çš„ä¸€ç§</p>
<ol>
<li>$m \subseteq n$</li>
<li>$m \cap n$ ä¸ä¸ºç©º</li>
<li>$n \subseteq m$</li>
</ol>
<h4 id="1">1</h4>
<p>ç¬¬ä¸€ç§æƒ…å†µ $m \subseteq n$ï¼Œç›´æ¥è¿”å›å½“å‰åŒºé—´ $m$ çš„å€¼å°±è¡Œäº†</p>
<h4 id="2">2</h4>
<p>ç¬¬äºŒç§æƒ…å†µ $m \cap n$ ä¸ä¸ºç©º</p>
<p>ä»¤ $mid= \frac{s+t}{2}$</p>
<ol>
<li>$l \le mid$ åˆ™è¯´æ˜å¾…ä¿®æ”¹åŒºé—´ï¼ˆä¸€éƒ¨åˆ†ï¼‰åœ¨å½“å‰èŠ‚ç‚¹çš„å·¦å­©å­</li>
<li>$r &gt; mid$ åˆ™è¯´æ˜å¾…ä¿®æ”¹åŒºé—´ï¼ˆä¸€éƒ¨åˆ†ï¼‰åœ¨å½“å‰èŠ‚ç‚¹çš„å³å­©å­</li>
</ol>
<p>é‡å¤å¤šæ¬¡åå°±å¾—åˆ°äº†æƒ…å†µ 1
ï¼ˆç”»ä¸ªå›¾æ¨¡æ‹Ÿä¸‹å°±æ˜ç™½äº†ï¼‰</p>
<h4 id="3">3</h4>
<p>ç¬¬ä¸‰ç§æƒ…å†µ $n \subseteq m$</p>
<p>è§£å†³æ–¹æ³•å’Œæƒ…å†µ 2 ç›¸åŒ</p>
<pre><code class="language-cpp">// åŒºé—´ä¿®æ”¹ [l, r] ä¿®æ”¹åŒºé—´ï¼Œ[s, t]å½“å‰åŒºé—´ï¼Œk å½“å‰èŠ‚ç‚¹ï¼Œaddition ä¿®æ”¹çš„å€¼
void update(LL l, LL r, LL k, LL addition) {
    LL s = tree[k].l, t = tree[k].r;
    LL mid = (s + t) / 2;

    if(l&lt;=s &amp;&amp; t&lt;=r) {
        tree[k].f += addition;
        tree[k].w += addition * (t - s + 1);
        return;
    }

    // ä¸æ»¡è¶³ä¸Šé¢çš„ ifï¼Œæ‰€ä»¥éœ€è¦ä¿®æ”¹å­èŠ‚ç‚¹ï¼Œæ‰€ä»¥éœ€è¦ä¸‹ä¼ æ‡’æ ‡è®°
    if(tree[k].f) down(k);
    if(l &lt;= mid) update(l, r, k*2, addition);
    if(r &gt; mid) update(l, r, 2*k+1, addition);
    tree[k].w = tree[2*k].w + tree[2*k+1].w;
}</code></pre>
<h3 id="åŒºé—´æŸ¥è¯¢">åŒºé—´æŸ¥è¯¢</h3>
<p>ä¸åŒºé—´ä¿®æ”¹åŸºæœ¬ä¸€æ ·</p>
<p>$n = [l, r]$ éœ€è¦æŸ¥è¯¢çš„åŒºé—´ï¼Œ$m = [s, t]$ å½“å‰åŒºé—´</p>
<p>$n, m$ åªæ»¡è¶³ä»¥ä¸‹ä¸‰ç§å…³ç³»çš„ä¸€ç§</p>
<ol>
<li>$m \subseteq n$</li>
<li>$m \cap n$ ä¸ä¸ºç©º</li>
<li>$n \subseteq m$</li>
</ol>
<pre><code class="language-cpp">// åŒºé—´æŸ¥è¯¢ï¼Œ[l, r] æŸ¥è¯¢åŒºé—´ï¼Œ[s, t]å½“å‰åŒºé—´ï¼Œk å½“å‰èŠ‚ç‚¹
LL getsum(LL l, LL r, LL k) {
    LL s = tree[k].l, t = tree[k].r;
    LL mid = (s + t) / 2, sum = 0;

    // ä¸æ»¡è¶³ä¸Šé¢çš„ ifï¼Œæ‰€ä»¥éœ€è¦ä¿®æ”¹å­èŠ‚ç‚¹ï¼Œæ‰€ä»¥éœ€è¦ä¸‹ä¼ æ‡’æ ‡è®°
    if(l&lt;=s &amp;&amp; t&lt;=r) return tree[k].w;

    if(tree[k].f) down(k);
    if(l &lt;= mid) sum += getsum(l, r, k*2);
    if(r &gt; mid) sum += getsum(l, r, 2*k+1);
    return sum;
}</code></pre>
<h3 id="ä»£ç ">ä»£ç </h3>
<pre><code class="language-cpp">#include &lt;cstdio&gt;
#define LL long long

LL n, m;
struct node {
    LL l, r, w, f; // w å€¼ï¼Œf æ‡’æ ‡è®°
}tree[400001]; // å¤§å° 4 * n

LL read() {
    bool flag = 0; LL x = 0; char ch = getchar();
    while(ch&lt;&#39;0&#39; || ch&gt;&#39;9&#39;) {if (ch == &#39;-&#39;) flag = 1; ch = getchar();}
    while(ch&gt;=&#39;0&#39; &amp;&amp; ch &lt;= &#39;9&#39;) {x *= 10; x += ch - &#39;0&#39;; ch = getchar();}
    return flag ? - x : x;
}

// å»ºæ ‘ï¼Œk å½“å‰èŠ‚ç‚¹
void build(LL l, LL r, LL k) {
    LL mid = (l + r) / 2;
    tree[k].l = l, tree[k].r = r;
    if (l == r) { // åˆ¤æ–­å¶å­èŠ‚ç‚¹
        tree[k].w = read();
        return;
    }
    build(l, mid, 2*k);
    build(mid+1, r, 2*k+1);
    tree[k].w = tree[2*k].w + tree[2*k+1].w;
}

// æ‡’æ ‡è®°ä¸‹ä¼ ï¼Œk å½“å‰èŠ‚ç‚¹
void down(LL k) {
    tree[k * 2].f += tree[k].f;
    tree[k * 2].w += tree[k].f * (tree[k*2].r - tree[k*2].l + 1);
    tree[k*2 + 1].f += tree[k].f;
    tree[k*2 + 1].w += tree[k].f * (tree[k*2+1].r - tree[k*2+1].l + 1);
    tree[k].f = 0;
}

// å•ç‚¹ä¿®æ”¹ï¼Œk å½“å‰èŠ‚ç‚¹
void add(LL k, LL addition) {
    LL l = tree[k].l, r = tree[k].r;
    LL mid = (l + r) / 2;

    if (l == r) {
        tree[k].w += addition;
        return;
    }

    // ä¸æ»¡è¶³ä¸Šé¢çš„ ifï¼Œæ‰€ä»¥éœ€è¦ä¿®æ”¹å­èŠ‚ç‚¹ï¼Œæ‰€ä»¥éœ€è¦ä¸‹ä¼ æ‡’æ ‡è®°
    if (tree[k].f) down(k);

    if (x &lt;= mid) add(2 * k);
    else add(2*k + 1);
    tree[k].w = tree[2*k].w + tree[2*k+1].w;
}

// å•ç‚¹æŸ¥è¯¢ï¼Œk å½“å‰èŠ‚ç‚¹
LL ask(LL k) {
    LL l = tree[k].l, r = tree[k].r;
    LL mid = (l + r) / 2;

    // ä¸æ»¡è¶³ä¸Šé¢çš„ ifï¼Œæ‰€ä»¥éœ€è¦ä¿®æ”¹å­èŠ‚ç‚¹ï¼Œæ‰€ä»¥éœ€è¦ä¸‹ä¼ æ‡’æ ‡è®°
    if (l == r) return tree[k].w;

    if (x &lt;= mid) ask[2 * k];
    else ask(2*k + 1)
}

// åŒºé—´ä¿®æ”¹ [l, r] ä¿®æ”¹åŒºé—´ï¼Œ[s, t]å½“å‰åŒºé—´ï¼Œk å½“å‰èŠ‚ç‚¹ï¼Œaddition ä¿®æ”¹çš„å€¼
void update(LL l, LL r, LL k, LL addition) {
    LL s = tree[k].l, t = tree[k].r;
    LL mid = (s + t) / 2;

    if(l&lt;=s &amp;&amp; t&lt;=r) {
        tree[k].f += addition;
        tree[k].w += addition * (t - s + 1);
        return;
    }

    // ä¸æ»¡è¶³ä¸Šé¢çš„ ifï¼Œæ‰€ä»¥éœ€è¦ä¿®æ”¹å­èŠ‚ç‚¹ï¼Œæ‰€ä»¥éœ€è¦ä¸‹ä¼ æ‡’æ ‡è®°
    if(tree[k].f) down(k);
    if(l &lt;= mid) update(l, r, k*2, addition);
    if(r &gt; mid) update(l, r, 2*k+1, addition);
    tree[k].w = tree[2*k].w + tree[2*k+1].w;
}

// åŒºé—´æŸ¥è¯¢ï¼Œ[l, r] æŸ¥è¯¢åŒºé—´ï¼Œ[s, t]å½“å‰åŒºé—´ï¼Œk å½“å‰èŠ‚ç‚¹
LL getsum(LL l, LL r, LL k) {
    LL s = tree[k].l, t = tree[k].r;
    LL mid = (s + t) / 2, sum = 0;

    // ä¸æ»¡è¶³ä¸Šé¢çš„ ifï¼Œæ‰€ä»¥éœ€è¦ä¿®æ”¹å­èŠ‚ç‚¹ï¼Œæ‰€ä»¥éœ€è¦ä¸‹ä¼ æ‡’æ ‡è®°
    if(l&lt;=s &amp;&amp; t&lt;=r) return tree[k].w;

    if(tree[k].f) down(k);
    if(l &lt;= mid) sum += getsum(l, r, k*2);
    if(r &gt; mid) sum += getsum(l, r, 2*k+1);
    return sum;
}

int main() {
    n = read(), m = read();
    build(1, n, 1);

    while (m--) {
        LL t = read(), x = read(), y = read();
        if (t == 2)
            printf(&quot;%lld\n&quot;, getsum(x, y, 1, n, 1));
        else {
            LL k = read();
            update(x, y, 1, n, 1, k);
        }
    }
    return 0;
}</code></pre>
<p>å­¦å®Œå¯ä»¥åšåš <a href="https://www.luogu.com.cn/problem/P2068">P2068 ç»Ÿè®¡å’Œ</a></p>
<p>[^1]: é¢˜ç›®æ¥æº <a href="https://www.luogu.com.cn/problem/P3372">ã€æ¨¡æ¿ã€‘çº¿æ®µæ ‘ 1 - æ´›è°·</a>
[^2]: æ¥è‡ª <a href="https://oi-wiki.org/ds/seg/#_4">çº¿æ®µæ ‘ - OI Wiki</a></p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[P3368 ã€æ¨¡æ¿ã€‘æ ‘çŠ¶æ•°ç»„ 1]]></title>
            <link>https://tiiwoo.github.io/TiiWoo.github.io/posts/fenwick-tree-1/</link>
            <guid>https://tiiwoo.github.io/TiiWoo.github.io/posts/fenwick-tree-1/</guid>
            <pubDate>Sat, 06 Feb 2021 00:00:00 GMT</pubDate>
            <content:encoded><![CDATA[<h2 id="é¢˜ç›®">é¢˜ç›®</h2>
<p>[^1]</p>
<h4 id="é¢˜ç›®æè¿°">é¢˜ç›®æè¿°</h4>
<p>å¦‚é¢˜ï¼Œå·²çŸ¥ä¸€ä¸ªæ•°åˆ—ï¼Œä½ éœ€è¦è¿›è¡Œä¸‹é¢ä¸¤ç§æ“ä½œï¼š</p>
<ul>
<li>å°†æŸä¸€ä¸ªæ•°åŠ ä¸Š $x$</li>
<li>æ±‚å‡ºæŸåŒºé—´æ¯ä¸€ä¸ªæ•°çš„å’Œ</li>
</ul>
<!--more-->

<h4 id="è¾“å…¥æ ¼å¼">è¾“å…¥æ ¼å¼</h4>
<p>ç¬¬ä¸€è¡ŒåŒ…å«ä¸¤ä¸ªæ­£æ•´æ•° $n,m$ï¼Œåˆ†åˆ«è¡¨ç¤ºè¯¥æ•°åˆ—æ•°å­—çš„ä¸ªæ•°å’Œæ“ä½œçš„æ€»ä¸ªæ•°ã€‚</p>
<p>ç¬¬äºŒè¡ŒåŒ…å« $n$ ä¸ªç”¨ç©ºæ ¼åˆ†éš”çš„æ•´æ•°ï¼Œå…¶ä¸­ç¬¬ $i$ ä¸ªæ•°å­—è¡¨ç¤ºæ•°åˆ—ç¬¬ $i$ é¡¹çš„åˆå§‹å€¼ã€‚</p>
<p>æ¥ä¸‹æ¥ $m$ è¡Œæ¯è¡ŒåŒ…å« 33 ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºä¸€ä¸ªæ“ä½œï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>1 x k</code> å«ä¹‰ï¼šå°†ç¬¬ $x$ ä¸ªæ•°åŠ ä¸Š $k$</li>
<li><code>2 x y</code> å«ä¹‰ï¼šè¾“å‡ºåŒºé—´ $[x,y]$ å†…æ¯ä¸ªæ•°çš„å’Œ</li>
</ul>
<h4 id="è¾“å‡ºæ ¼å¼">è¾“å‡ºæ ¼å¼</h4>
<p>è¾“å‡ºåŒ…å«è‹¥å¹²è¡Œæ•´æ•°ï¼Œå³ä¸ºæ‰€æœ‰æ“ä½œ 22 çš„ç»“æœã€‚</p>
<h4 id="è¾“å…¥è¾“å‡ºæ ·ä¾‹">è¾“å…¥è¾“å‡ºæ ·ä¾‹</h4>
<p><strong>è¾“å…¥ #1</strong></p>
<pre><code class="language-text">5 5
1 5 4 2 3
1 1 3
2 2 5
1 3 -1
1 4 2
2 1 4</code></pre>
<p><strong>è¾“å‡º #1</strong></p>
<pre><code class="language-text">14
16</code></pre>
<h4 id="è¯´æ˜æç¤º">è¯´æ˜/æç¤º</h4>
<p>ã€æ•°æ®èŒƒå›´ã€‘</p>
<p>å¯¹äº $30%$ çš„æ•°æ®ï¼Œ$1 \le n \le 8ï¼Œ1\le m \le 10$ï¼›</p>
<p>å¯¹äº $70%$ çš„æ•°æ®ï¼Œ$1\le n,,m\le10^4;$</p>
<p>å¯¹äº $100%$ çš„æ•°æ®ï¼Œ$1\le n,m \le 5\times 10^5$ã€‚</p>
<p>æ ·ä¾‹è¯´æ˜ï¼š</p>
<p>æ•…è¾“å‡ºç»“æœ 14ã€16</p>
<p><img src="https://gitee.com/royce2003/blog/raw/master/img/2256.png" alt="æ•°æ®èŒƒå›´"></p>
<p>(å†™è¿™ç¯‡å‘¢å…¶å®æ˜¯å› ä¸ºè‡ªå·±å·²ç»ä¸ä¼šæ ‘çŠ¶æ•°ç»„äº†ï¼Œæ­£å¥½å€Ÿæ­¤æœºä¼šå¤ä¹ ä¸‹ QAQ)</p>
<h2 id="é¢˜è§£">é¢˜è§£</h2>
<h3 id="æ ‘çŠ¶æ•°ç»„">æ ‘çŠ¶æ•°ç»„</h3>
<p>é¦–å…ˆéœ€è¦äº†è§£ä»€ä¹ˆæ˜¯ <code>æ ‘çŠ¶æ•°ç»„</code></p>
<p>æ ‘çŠ¶æ•°ç»„ç”¨çš„æ˜¯æ ‘ç»“æ„çš„æ€æƒ³ï¼Œå³æ ‘å‹é€»è¾‘ç»“æ„ï¼Œä½†ä»–ä¸æ˜¯æ ‘å½¢ç»“æ„å•¦</p>
<h4 id="ç‰¹ç‚¹">ç‰¹ç‚¹</h4>
<blockquote>
<p>æ ‘çŠ¶æ•°ç»„ (Binary Indexed Tree(B.I.T), Fenwick Tree)æ˜¯ä¸€ä¸ªæŸ¥è¯¢å’Œä¿®æ”¹å¤æ‚åº¦éƒ½ä¸º og(n) çš„æ•°æ®ç»“æ„ã€‚ä¸»è¦ç”¨äºæŸ¥è¯¢ä»»æ„ä¸¤ä½ä¹‹é—´çš„æ‰€æœ‰å…ƒç´ ä¹‹å’Œï¼Œä½†æ˜¯æ¯æ¬¡åªèƒ½ä¿®æ”¹ä¸€ä¸ªå…ƒç´ çš„å€¼ï¼›ç»è¿‡ç®€å•ä¿®æ”¹å¯ä»¥åœ¨ log(n) çš„å¤æ‚åº¦ä¸‹è¿›è¡ŒèŒƒå›´ä¿®æ”¹ï¼Œä½†æ˜¯è¿™æ—¶åªèƒ½æŸ¥è¯¢å…¶ä¸­ä¸€ä¸ªå…ƒç´ çš„å€¼(å¦‚æœåŠ å…¥å¤šä¸ªè¾…åŠ©æ•°ç»„åˆ™å¯ä»¥å®ç°åŒºé—´ä¿®æ”¹ä¸åŒºé—´æŸ¥è¯¢)ã€‚</p>
</blockquote>
<p>å¯¹äºè¿™é¢˜ï¼Œç®€å•æ¥è¯´å°±æ˜¯å•ç‚¹ä¿®æ”¹åŒºé—´æŸ¥è¯¢ï¼Œä¸€èˆ¬åœ°ï¼Œæ ‘çŠ¶æ•°ç»„ä¸æ”¯æŒåŒºé—´ä¿®æ”¹å•ç‚¹å·®é€‰ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿæœ‰åŠæ³•è®©ä»–æ”¯æŒ.....</p>
<p>æ ‘çŠ¶æ•°ç»„çš„ä¼˜åŠ¿å°±åœ¨äºå…¶ç»´æŠ¤çš„æ—¶é—´å¤æ‚åº¦ä¸º $O(log , n)$ ï¼Œè€Œç±»ä¼¼çš„å‰ç¼€å’Œæ•°ç»„ç»´æŠ¤çš„æ—¶é—´å¤æ‚åº¦ä¸º $O(n)$ï¼Œä¸¤è€…çš„æŸ¥è¯¢éƒ½æ˜¯ $O(1)$</p>
<p>ï¼ˆè¯´åˆ°è¿™æˆ‘å°±æƒ³èµ·æ¥æŸæ¬¡æ ¡å†…èµ›çš„xztä¹°ç…é¥¼ã€‚ã€‚ã€‚ã€‚è¿˜å¥½æˆ‘æ‹¿äº†20åˆ†ï¼‰</p>
<h3 id="å‰ç½®çŸ¥è¯†">å‰ç½®çŸ¥è¯†</h3>
<h4 id="lowbit">lowbit</h4>
<p>å®é™…ä¸Šï¼Œå¯¹äºæ ‘çŠ¶æ•°ç»„ $tree$ çš„æ¯ä¸€ä¸ª $i$ï¼Œå…¶å®é™…æ„ä¹‰åº”è¯¥ä¸ºï¼šç®—ä¸Šå…¶æœ¬èº«çš„è®¯æ¯ï¼Œæ€»å…±å­˜å‚¨äº† $2^k$ ä¸ªå…ƒç´ çš„ä¿¡æ¯ï¼Œå…¶ä¸­ $k$ è¡¨ç¤º $i$ åœ¨äºŒè¿›åˆ¶ä¸‹ï¼Œæœ«å°¾é›¶çš„ä¸ªæ•°ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥è¡¨ç¤ºæœ€å°çš„å« 1 ä½çš„äºŒè¿›åˆ¶æƒå€¼â€”â€”æ¢å¥è¯è®²ï¼Œ$2^k$ å³å¯è¡¨ç¤ºæˆï¼šå¯¹äºæ¯ä¸ªäºŒè¿›åˆ¶æ„ä¹‰ä¸‹çš„ $i$ï¼Œä»æœ€æœ«ä½æ•° $k+1$ ä½ï¼Œä¿ç•™è¿™ $k+1$ ä½å¹¶åˆ é™¤ $k+1$ ä½ä»¥å·¦çš„æ‰€æœ‰æ•°ä½ä¸Šçš„æ•°ï¼Œç•™ä¸‹çš„æ–°äºŒè¿›åˆ¶æ•°çš„å®é™…å¤§</p>
<p><img src="https://gitee.com/royce2003/blog/raw/master/img/0dd7912397dda14482d369acbfb7d0a20df486d1.jpg" alt="æ ‘çŠ¶æ•°ç»„ç»“æ„"></p>
<table>
<thead>
<tr>
<th align="center">åè¿›åˆ¶</th>
<th align="center">äºŒè¿›åˆ¶</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">10</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">11</td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">100</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">101</td>
</tr>
<tr>
<td align="center">6</td>
<td align="center">110</td>
</tr>
<tr>
<td align="center">7</td>
<td align="center">111</td>
</tr>
<tr>
<td align="center">8</td>
<td align="center">1000</td>
</tr>
<tr>
<td align="center">9</td>
<td align="center">1001</td>
</tr>
<tr>
<td align="center">10</td>
<td align="center">1010</td>
</tr>
</tbody></table>
<p>å›¾æ–‡å¹¶èŒ‚ä¹‹åæœ‰æ²¡æœ‰çœ‹å‡ºç‚¹ä»€ä¹ˆ QAQ</p>
<p>è®°å¾—å½“æ—¶å­¦çš„æ—¶å€™ï¼Œåœ¨å­¦æ ¡å¤§ä½¬çš„å¸®åŠ©ä¸‹æ‰ç†è§£äº†è¿™äº›ä¸œè¥¿ï¼Œå¯èƒ½æˆ‘æ¯”è¾ƒèœå§</p>
<p><del>æ²¡çœ‹å‡ºæ¥å°±å¤šçœ‹å‡ éå§</del> å¥½åƒä¹Ÿè¿˜æ˜¯çœ‹ä¸å‡ºæ¥ï¼Œé‚£å°±è®°ä¸‹æ¥ç»“è®ºå§</p>
<p>å¯¹äºæ¯ä¸€ä¸ª $x$ çš„æœ€ä½å«ä¸€ä½ï¼Œå³ä¸Šæ–‡ä¸­çš„ $2^k$,å¯ä»¥å€ŸåŠ©ä¸€ä¸ª $lowbit$ å‡½æ•°å®ç° emmm ä¸€ä¸ªæå…¶ç„å­¦çš„ä¸œè¥¿</p>
<p>å†æŠŠ <code>lowbit</code> è¯´ç®€å•ç‚¹å°±æ˜¯</p>
<p>æŠŠä¸€ä¸ªæ•´æ•°å˜æˆäºŒè¿›åˆ¶ï¼Œä»å³å¾€å·¦æ‰¾åˆ°ç¬¬ä¸€ä¸ª1ï¼Œç„¶åè¿”å›è¿™ä¸ª1æ‰€è¡¨ç¤ºçš„åè¿›åˆ¶å€¼ã€‚</p>
<p>ç„å­¦å…¬å¼ç™»åœº <code>x &amp; -x</code></p>
<p>ä¸¾ä¸ªä¾‹å­</p>
<p>$$
4 = 100,,-4 = 011 + 1 = 100\
~\
\because100,&amp;,100=100=4 \
 ~\
\therefore lowbit(4)=4\
$$</p>
<pre><code class="language-cpp">int lowbit(int x) {
    return x &amp; -x; //å°±æ˜¯è¿™ä¹ˆç„å­¦
}</code></pre>
<p>ä¸ºä»€ä¹ˆè¦è¿™æ ·å¹²å‘¢</p>
<p>æˆ‘ä»¬å…ˆåˆ—å‡º 1~8 çš„ $lowbit$</p>
<p>$1;2;1;4;1;2;1;8$</p>
<p>æˆ‘ä»¬è®© $C[i]$ ç®¡ç† $A[i-lowbit(i)+1,,i]$ è¿™æ®µåŒºé—´ï¼Œå¦‚ä¸‹å›¾</p>
<p><img src="https://gitee.com/royce2003/blog/raw/master/img/Snipaste_03-19_11-45-31.png" alt="å¯¹åº”ç®¡ç†"></p>
<p>é‚£ä¹ˆæˆ‘ä»¬æŠŠæŸä¸ªç‚¹ $+x$ çš„æ—¶å€™åªéœ€è¦æŠŠèƒ½ç®¡åˆ°è¿™ä¸ªç‚¹çš„éƒ½ $+x$ å°±å¥½å•¦ï¼Œé‚£æˆ‘ä»¬å¦‚ä½•æ‰¾å“ªäº›èƒ½ç®¡åˆ°æˆ‘ä»¬ä¿®æ”¹çš„ç‚¹å‘¢ï¼Œè¿™æ—¶å€™å°±éœ€è¦ $lowbit$ äº†</p>
<h4 id="å‰ç¼€å’Œ">å‰ç¼€å’Œ</h4>
<h5 id="ä¸€ç»´å‰ç¼€å’Œ">ä¸€ç»´å‰ç¼€å’Œ</h5>
<p>ç°æœ‰ä¸€ä¸ªé•¿åº¦ä¸º $N$ çš„åºåˆ— $A$ï¼Œéœ€è¦è¿›è¡Œ $M$ æ¬¡æ“ä½œï¼Œæ¯æ¬¡æ“ä½œé€‰å–ä» $A_i$ åˆ° $A_j$ å…± $j-i+1$ ä¸ªæ•°å¹¶æ±‚å‡ºä»–ä»¬çš„æ€»å’Œ ï¼ˆN å’Œ M å¯ä»¥å¾ˆå¤§ï¼‰  </p>
<p>ä¾‹ï¼š</p>
<p>$$
N=9,;A={3,1,4,1,5,9,2,6,5}
$$</p>
<p>å¦‚æœæŒ‰ç…§é¢˜æ„æš´åŠ›ï¼Œæœ€åæƒ…å†µä¸‹æ—¶é—´å¤æ‚åº¦ $O(n\times m)$ï¼ˆæ˜¯è¿™ä¸ªå—ï¼Œæˆ‘å’‹æ„Ÿè§‰æ—¶é—´å¤æ‚åº¦å¥½åƒå¤§æ¦‚å¯èƒ½ä¸æ˜¯è¿™ä¸ªQAQï¼‰</p>
<p>åæ­£æ—¶é—´å¤æ‚åº¦æŒºé«˜çš„å°±å¯¹äº†</p>
<p>é‚£æˆ‘ä»¬å¯ä»¥æ–°å»ºä¸€ä¸ªæ•°ç»„ $B$ ï¼Œå…¶ä¸­ $B_i=B_{i-1} +A_i$</p>
<p>æ­¤æ—¶æˆ‘ä»¬éœ€è¦æ±‚ $a_i-a_j$ çš„æ€»å’Œï¼Œ<del>æ„ä¼šä¸‹</del>ï¼Œåªéœ€è¦æ±‚ $B_j-B_{i-1}$ å°±å¥½å•¦</p>
<p><del>å¾ˆæ˜æ˜¾</del>ï¼Œåˆ©ç”¨å‰ç¼€å’Œçš„æ–¹æ³•ï¼Œå› ä¸ºBæ•°ç»„æ˜¯åœ¨è¯»å…¥æ—¶è¿›è¡Œå¤„ç†ï¼Œå¯ä»¥çœ‹ä½œä¸éœ€è¦æ—¶é—´ï¼Œè€ŒæŸ¥è¯¢çš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯ $O(1)$ å•¦</p>
<h5 id="äºŒç»´å‰ç¼€å’Œ">äºŒç»´å‰ç¼€å’Œ</h5>
<p>ä¸€ç»´å‰ç¼€å’Œä¼šäº†äºŒç»´çš„ä¹Ÿå¾ˆç®€å•</p>
<p>$$
A=
\left[
\begin{matrix}
5 &amp; 6 &amp; 6 &amp; 1 &amp; 4 &amp; 6\
3 &amp; 4 &amp; 2 &amp; 4 &amp; 1 &amp; 7 \
0 &amp; 9 &amp; 4 &amp; 6 &amp; 2 &amp; 4
\end{matrix}
\right]
;
B=
\left[
\begin{matrix}
5 &amp; 11 &amp; 17 &amp; 18 &amp; 21 &amp; 27\
8 &amp; 18 &amp; 26 &amp; \cdots &amp; \cdots &amp; \cdots \
\cdots &amp; \cdots &amp; \cdots &amp; \cdots  &amp; \cdots &amp; \cdots
\end{matrix}
\right]
$$</p>
<p>è‹¥æˆ‘ä»¬è¦æ±‚ $x_1,,y_1$ ä¸ $x_2,,y_2$ ä¸¤ç‚¹æ‰€å›´æˆçŸ©å½¢å†…æ•°å­—çš„å’Œ
å…¬å¼ $sum=B_{x_2,y_2}-B_{x_2,1}-B_{1,y_1}+B_{x_1-1,y_1-1}$</p>
<h3 id="å‚¨å­˜">å‚¨å­˜</h3>
<p>æ ‘çŠ¶æ•°ç»„æœ¬è´¨å°±æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæˆ‘ä»¬ç”¨ C æ¥è¡¨ç¤ºï¼Œç„¶åæŠŠ C æ’æˆæ•°ğŸ„çš„æ ·å­ï¼Œå°±åƒå‰é¢çš„é‚£ä¸ªå›¾é‚£æ ·</p>
<p><img src="https://gitee.com/royce2003/blog/raw/master/img/0dd7912397dda14482d369acbfb7d0a20df486d1.jpg" alt="æ ‘çŠ¶æ•°ç»„ç»“æ„"></p>
<p>$C[1]=A[1]$<br>$C[2]=A[1]+A[2]$<br>$C[3]=A[3]$<br>$C[4]=A[1]+A[2]+A[3]+A[4]$<br>$C[5]=A[5]$<br>$C[6]=A[5]+A[6]$<br>$C[7]=A[7]$<br>$C[8]=A[1]+A[2] \cdots A[8]$</p>
<p>å¾ˆæ˜æ˜¾ $C[i]=A[i-lowbit(i)+1]+A[i-lowbit(i)+2]+ \cdots +A[i]$</p>
<p>ç”¨ä»£ç å†™å°±æ˜¯</p>
<pre><code class="language-cpp">for (j=i-lowbit(i)+1; j&lt;= i; j++)
    c[i] += a[j];</code></pre>
<p>å¯¹äº 1, 3, 5, 7 è¿™ç±» $C[i]$ ååªæœ‰ä¸€ä¸ª $A[i]$ çš„ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºåŸºç‚¹<br>ä¸éš¾å‘ç°åŸºç‚¹çš„éƒ½æ˜¯æ˜¯å¥‡æ•°ï¼Œå³ lowbit=1
åä¹‹ï¼Œlowbit=1 çš„æ•°ä¸€å®šæ˜¯å¥‡æ•°ï¼Œä¹Ÿä¸€å®šæ˜¯åŸºç‚¹ã€‚</p>
<p>è€Œå¯¹äº 1, 2, 4, 8 è¿™ç±» $C[i]$ åæ˜¯ $\sum_{x=1}^i a_x$ çš„ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºç»Ÿæ‹¬ç‚¹<br>ä¹Ÿä¸éš¾å‘ç°ï¼Œç»Ÿæ‹¬ç‚¹çš„äºŒè¿›åˆ¶èƒ½å†™æˆ 1000â€¦â€¦ çš„å½¢å¼
é‚£ä¹ˆç»Ÿæ‹¬ç‚¹ä¸€å®šå°±æ˜¯ 2 çš„å¹‚ï¼Œåä¹‹ 2 çš„å¹‚ä¹Ÿä¸€å®šæ˜¯ç»Ÿæ‹¬ç‚¹</p>
<p>ç‰¹åˆ«çš„ï¼Œ1 æ—¢æ˜¯åŸºç‚¹åˆæ˜¯ç»Ÿæ‹¬ç‚¹<br>6 ä¸æ˜¯åŸºç‚¹ä¹Ÿä¸æ˜¯ç»Ÿæ‹¬ç‚¹</p>
<h3 id="å•ç‚¹ä¿®æ”¹">å•ç‚¹ä¿®æ”¹</h3>
<p>å¦‚ä½•è¿›è¡Œå•ç‚¹ä¿®æ”¹ï¼Œå…¶å®åœ¨ä¹‹å‰å·²ç»è®²è¿‡äº†<br>æ¯”å¦‚æˆ‘ä»¬è®© $A[3]+1$ï¼Œé‚£ä¹ˆæœ‰åŒ…å« $A[3]$ çš„æ‰€æœ‰ $C$ éƒ½è¦ $+1$
åŒ…æ‹¬ $C[3],C[4],C[8],C[16],C[32]\cdots$</p>
<p>é‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦è¿™æ ·å°±è¡Œäº†</p>
<pre><code class="language-cpp">for(j=i; j&lt;=n; j+=lowbit(j))
    C[i] += x;</code></pre>
<h3 id="åŒºé—´æŸ¥è¯¢">åŒºé—´æŸ¥è¯¢</h3>
<p>è¦æƒ³å¾—åˆ° i åˆ° j çš„æ‰€æœ‰æ•°çš„æ€»å’Œ $sum_{i,j}$ï¼Œåªéœ€è¦å¾—åˆ° $sum_{1,i}$ å’Œ $sum_{1,j}$</p>
<p>$$
sum_{i,j} = sum_{1,i} - sum_{1,j} + A_i
$$</p>
<p>ä¹Ÿå°±æ˜¯å‰é¢è®²åˆ°çš„å‰ç¼€å’Œ</p>
<p>å…ˆæ±‚ $sum_{1,i}$ ï¼Œå³ä» i å¼€å§‹ä¸æ–­å‡å» lowbit å¹¶åŠ  C çš„å€¼ï¼Œç›´åˆ°æ‰¾åˆ°ç¬¬ä¸€ä¸ªç»Ÿæ‹¬ç‚¹ï¼ˆç¬¬ä¸€ä¸ªåŒ…å«è¯¥ç‚¹çš„ç»Ÿæ‹¬ç‚¹ï¼‰</p>
<pre><code class="language-cpp">int find(int x) {
    int sum = 0,i;
    for(i=x; i!=lowbit(i); i-=lowbit(i))
        sum += c[i];
    sum += c[i]; //å› ä¸ºæœ€åä¸€æ¬¡å¾ªç¯å¹¶æ²¡æœ‰è¿›å…¥ï¼Œæ•…åœ¨æ­¤å¤„å†åŠ ä¸€æ¬¡c[i]
    return sum;
}</code></pre>
<p>$sum_{1,j}$ åŒç†</p>
<h3 id="ç»“æŸ">ç»“æŸ</h3>
<p>é™„ä¸Š AC ä»£ç </p>
<pre><code class="language-cpp">#include &lt;cstdio&gt;
#include &lt;iostream&gt;
using namespace std;

int n,m,k,x,aa;
int a,c[500110];

int lowbit(int x) {
    return x &amp; -x;
}
void add(int x,int k) {
    while(x&lt;=n) {
        c[x] += k;
        x += lowbit(x);
    }
}
int find(int x) {
    int sum = 0,i;
    for(i=x;i!=lowbit(i);i-=lowbit(i))
        sum += c[i];
    sum += c[i];
    return sum;
}

int main() {ssd
    cin &gt;&gt; n &gt;&gt; m;
    for(int i=1;i&lt;=n;i++) {
        cin &gt;&gt; a;
        add(i,a);
    }
    while(m--) {
        cin &gt;&gt; aa &gt;&gt; x &gt;&gt; k;
        if(aa==1) add(x,k);
        else cout &lt;&lt; find(k) - find(x-1) &lt;&lt; endl; //æ­¤å¤„å’Œ find(k) - find(x) + a[x] æ˜¯ä¸€æ ·çš„
    }
    return 0;
}</code></pre>
<p>[^1]: é¢˜ç›®æ¥æºï¼š<a href="https://www.luogu.com.cn/problem/P3374">P3374 - æ´›è°· | è®¡ç®—æœºç§‘å­¦æ•™è‚²æ–°ç”Ÿæ€</a></p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[P3372 ã€æ¨¡æ¿ã€‘çº¿æ®µæ ‘ 2]]></title>
            <link>https://tiiwoo.github.io/TiiWoo.github.io/posts/segment-tree-2/</link>
            <guid>https://tiiwoo.github.io/TiiWoo.github.io/posts/segment-tree-2/</guid>
            <pubDate>Sat, 06 Feb 2021 00:00:00 GMT</pubDate>
            <content:encoded><![CDATA[<p>[^1]</p>
<h2 id="é¢˜ç›®æè¿°">é¢˜ç›®æè¿°</h2>
<p>å¦‚é¢˜ï¼Œå·²çŸ¥ä¸€ä¸ªæ•°åˆ—ï¼Œä½ éœ€è¦è¿›è¡Œä¸‹é¢ä¸‰ç§æ“ä½œï¼š</p>
<ul>
<li>å°†æŸåŒºé—´æ¯ä¸€ä¸ªæ•°ä¹˜ä¸Š $x$</li>
<li>å°†æŸåŒºé—´æ¯ä¸€ä¸ªæ•°åŠ ä¸Š $x$</li>
<li>æ±‚å‡ºæŸåŒºé—´æ¯ä¸€ä¸ªæ•°çš„å’Œ</li>
</ul>
<h2 id="è¾“å…¥æ ¼å¼">è¾“å…¥æ ¼å¼</h2>
<p>ç¬¬ä¸€è¡ŒåŒ…å«ä¸‰ä¸ªæ•´æ•° n,m,pï¼Œåˆ†åˆ«è¡¨ç¤ºè¯¥æ•°åˆ—æ•°å­—çš„ä¸ªæ•°ã€æ“ä½œçš„æ€»ä¸ªæ•°å’Œæ¨¡æ•°ã€‚</p>
<p>ç¬¬äºŒè¡ŒåŒ…å« n ä¸ªç”¨ç©ºæ ¼åˆ†éš”çš„æ•´æ•°ï¼Œå…¶ä¸­ç¬¬ i ä¸ªæ•°å­—è¡¨ç¤ºæ•°åˆ—ç¬¬ i é¡¹çš„åˆå§‹å€¼ã€‚</p>
<p>æ¥ä¸‹æ¥ m è¡Œæ¯è¡ŒåŒ…å«è‹¥å¹²ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºä¸€ä¸ªæ“ä½œï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p>
<p>æ“ä½œ $1$ï¼š æ ¼å¼ï¼š<code>1 x y k</code> å«ä¹‰ï¼šå°†åŒºé—´ $[x,y]$ å†…æ¯ä¸ªæ•°ä¹˜ä¸Š $k$</p>
<p>æ“ä½œ $2$ï¼š æ ¼å¼ï¼š<code>2 x y k</code> å«ä¹‰ï¼šå°†åŒºé—´ $[x,y]$ å†…æ¯ä¸ªæ•°åŠ ä¸Š $k$</p>
<p>æ“ä½œ $3$ï¼š æ ¼å¼ï¼š<code>3 x y</code> å«ä¹‰ï¼šè¾“å‡ºåŒºé—´ $[x,y]$ å†…æ¯ä¸ªæ•°çš„å’Œå¯¹ $p$ å–æ¨¡æ‰€å¾—çš„ç»“æœ</p>
<h2 id="è¾“å‡ºæ ¼å¼">è¾“å‡ºæ ¼å¼</h2>
<p>è¾“å‡ºåŒ…å«è‹¥å¹²è¡Œæ•´æ•°ï¼Œå³ä¸ºæ‰€æœ‰æ“ä½œ $3$ çš„ç»“æœã€‚</p>
<h2 id="è¾“å…¥è¾“å‡ºæ ·ä¾‹">è¾“å…¥è¾“å‡ºæ ·ä¾‹</h2>
<p><strong>è¾“å…¥ #1</strong></p>
<pre><code class="language-text">5 5 38
1 5 4 2 3
2 1 4 1
3 2 5
1 2 4 2
2 3 5 5
3 1 4</code></pre>
<p><strong>è¾“å‡º #1</strong></p>
<pre><code class="language-text">17
2</code></pre>
<h2 id="è¯´æ˜æç¤º">è¯´æ˜/æç¤º</h2>
<p>ã€æ•°æ®èŒƒå›´ã€‘</p>
<p>å¯¹äº $30%$ çš„æ•°æ®ï¼š$n \le 8$ï¼Œ$m \le 10$
å¯¹äº $70%$ çš„æ•°æ®ï¼š$n \le 10^3$ï¼Œ$m \le 10^4$
å¯¹äº $100%$ çš„æ•°æ®ï¼š$n \le 10^5$ï¼Œ$m \le 10^5$</p>
<p>é™¤æ ·ä¾‹å¤–ï¼Œ$p = 571373$</p>
<p>ï¼ˆæ•°æ®å·²ç»è¿‡åŠ å¼º^_^ï¼‰</p>
<p>æ ·ä¾‹è¯´æ˜ï¼š</p>
<p><img src="https://rmt.dogedoge.com/fetch/royce/storage/SegmentTree2/01.jpg?fmt=webp" alt="img"></p>
<p>æ•…è¾“å‡ºåº”ä¸º $17$ã€$22(40 \bmod 38 = 2)$</p>
<h2 id="æ‰€ä»¥">æ‰€ä»¥</h2>
<p>çœŸçš„æœ‰é‚£ä¹ˆäº¿ç‚¹ç‚¹éš¾ç†è§£ï¼Œä¹Ÿè¿˜ä¸æ€ä¹ˆä¼šï¼Œå­¦çš„æ—¶å€™ä¸»è¦æ˜¯çœ‹ <a href="https://oi-wiki.org/ds/seg/#luogu-p3373-2">çº¿æ®µæ ‘ - OI Wiki</a> çš„ä»£ç  å’Œ <a href="https://www.luogu.com.cn/blog/lhr/solution-p3373">é¢˜è§£ P3373 ã€ã€æ¨¡æ¿ã€‘çº¿æ®µæ ‘ 2ã€‘ - lqhsr çš„åšå®¢</a> çš„æ€è·¯</p>
<p>ä¸€ä¸ªè®²çš„æŒºæ˜ç™½çš„ï¼Œä¸€ä¸ªä»£ç çœ‹ç€æŒºæ˜ç™½çš„ :trophy:</p>
<h3 id="ç»“æ„ä½“å‡½æ•°">ç»“æ„ä½“å‡½æ•°</h3>
<p>ä¹‹å‰å­¦ç»“æ„ä½“çš„æ—¶å€™çŸ¥é“é‡Œé¢å¯ä»¥å®šä¹‰å‡½æ•°ï¼Œä¹Ÿåªæ˜¯çŸ¥é“ï¼Œä»æ¥æ²¡ç”¨è¿‡ã€‚
è¿™é¢˜å› ä¸ºç»å¸¸è¦ <code>mod</code>ï¼Œé…åˆç»“æ„ä½“å‡½æ•°è¿˜æ˜¯æŒºæ–¹ä¾¿çš„ã€‚</p>
<pre><code class="language-cpp">struct Test {
    int test1, test2, test3;
    void mod() {
        test1 %= p;
        test2 %= p;
        test3 %= p;
    }
}test[100];

test[k].mod();</code></pre>
<h3 id="æ‡’æ ‡è®°ä¸‹ä¼ ">æ‡’æ ‡è®°ä¸‹ä¼ </h3>
<p>å’Œçº¿æ®µæ ‘ 1 æ¯”ï¼Œå¤šäº†ä¸€ä¸ªä¹˜æ³•ï¼Œæ‰€ä»¥å¤šäº†ä¹˜æ³•æ‡’æ ‡è®°ï¼Œ<strong>åˆå€¼ä¸º 1</strong>ã€‚
ä¹˜æ³•æ‡’æ ‡è®°ä¸‹ä¼ æ—¶éœ€è¦å¯¹ <code>åŠ æ³•æ‡’æ ‡è®°</code>ã€<code>ä¹˜æ³•æ‡’æ ‡è®°</code>å’Œ<code>å€¼</code> è¿›è¡Œä¹˜æ³•ã€‚
åŒºé—´ä¹˜æ³•ä¹ŸåŒæ ·çš„éœ€è¦å¯¹è¿™ä¸‰ä¸ªå€¼è¿›è¡Œä¹˜æ³•ã€‚
å…¶ä»–çš„åŸºæœ¬å’Œçº¿æ®µæ ‘ 1 ä¸€æ ·ã€‚</p>
<p>æ‡’æ ‡è®°ä¸‹ä¼ çš„ä»£ç ç¡®å®æŒºé•¿çš„ï¼Œä½†ç†æ¸…æ€è·¯å‘ç°è¿˜æ˜¯æ¯”è¾ƒå¥½ç†è§£çš„ã€‚</p>
<ol>
<li>ä¹˜æ³•æ‡’æ ‡è®°ä¸ä¸º 1ï¼Œåˆ™éœ€è¦ä¸‹ä¼ ã€‚
åˆ†å·¦å³å„¿å­ï¼Œæ¯è¾¹å…ˆæŠŠæ‰€æœ‰çš„ä¹˜æ³•åšå¥½ï¼Œå† <code>.mod()</code></li>
</ol>
<p><strong>æœ€åçˆ¶äº²ä¹˜æ³•æ‡’æ ‡è®°èµ‹å€¼ä¸º 1</strong></p>
<ol start="2">
<li>åŠ æ³•æ‡’æ ‡è®°ä¸ä¸º 0ï¼Œåˆ™éœ€è¦ä¸‹ä¼ ã€‚ä¹Ÿåˆ†å·¦å³å„¿å­
å„¿å­æ‡’æ ‡è®°åŠ ä¸Šçˆ¶äº²æ‡’æ ‡è®°
å„¿å­å€¼åŠ ä¸Š ï¼ˆçˆ¶äº²æ‡’æ ‡è®° * å„¿å­æ‰€åŠå«çš„èŠ‚ç‚¹æ•°ï¼‰
å† <code>.mod()</code></li>
</ol>
<p><strong>æœ€åçˆ¶äº²æ‡’æ ‡è®°å½’é›¶</strong></p>
<h3 id="åŒºé—´ä¿®æ”¹">åŒºé—´ä¿®æ”¹</h3>
<p>æ•´ä½“æ€è·¯å’Œçº¿æ®µæ ‘ 1 çš„ä¸€æ ·ï¼Œä¹˜æ³•çš„åŒºé—´ä¿®æ”¹å”¯ä¸€çš„åŒºåˆ«å°±åœ¨æœ€åä¸€æ­¥</p>
<pre><code class="language-cpp">if (l&lt;=s &amp;&amp; t&lt;=r) {
    tree[k].m *= c;
    tree[k].f *= c;
    tree[k].w *= c;
    tree[k].mod();
    return;
}</code></pre>
<h3 id="å®Œæ•´ä»£ç ">å®Œæ•´ä»£ç </h3>
<pre><code class="language-cpp">#include &lt;cstdio&gt;

long long n, m, d, x, y, at, c, p;
struct node {
    long long l, r, w, f, m;
    void mod() {
        w %= p;
        f %= p;
        m %= p;
    }
}tree[400010];

long long read() {
    bool flag = false; long long x = 0; char ch = getchar();
    while(ch&lt;&#39;0&#39; || ch&gt;&#39;9&#39;) {if(ch == &#39;-&#39;) flag = 1; ch = getchar();}
    while(ch&gt;=&#39;0&#39; &amp;&amp; ch &lt;= &#39;9&#39;) {x *= 10; x += ch - &#39;0&#39;; ch = getchar();}
    return flag ? - x : x;
}

void build(long long l, long long r, long long k) {
    long long mid = (l + r) / 2;
    tree[k].l = l, tree[k].r = r, tree[k].m = 1;
    if (l == r) {
        tree[k].w = read();
        return;
    }
    build(l, mid, 2*k);
    build(mid+1, r, 2*k+1);
    tree[k].w = tree[2*k].w + tree[2*k+1].w;
    tree[k].mod();
}

void down(long long k) {
    long long lson = 2 * k, rson = 2 * k + 1;
    int m = tree[k].m, f = tree[k].f;
    if (tree[k].m != 1) {
        tree[lson].w *= m;
        tree[lson].f *= m;
        tree[lson].m *= m;
        tree[lson].mod();

        tree[rson].w *= m;
        tree[rson].f *= m;
        tree[rson].m *= m;
        tree[rson].mod();

        tree[k].m = 1;
    }
    if (f) {
        tree[lson].f += f;
        tree[lson].w += f * (tree[lson].r - tree[lson].l + 1);
        tree[lson].mod();

        tree[rson].f += f;
        tree[rson].w += f * (tree[rson].r - tree[rson].l + 1);
        tree[rson].mod();

        tree[k].f = 0;
    }
}

void cheng(long long l, long long r, long long k, long long c) {
    long long s = tree[k].l, t = tree[k].r;
    long long mid = (s + t) / 2;

    if (l&lt;=s &amp;&amp; t&lt;=r) {
        tree[k].m *= c;
        tree[k].f *= c;
        tree[k].w *= c;
        tree[k].mod();
        return;
    }

    down(k);
    if (l &lt;= mid) cheng(l, r, 2*k, c);
    if (r &gt;= mid + 1) cheng(l, r, 2*k+1, c);

    tree[k].w = tree[2*k].w + tree[2*k+1].w;
    tree[k].w %= p;
}

void add(long long l, long long r, long long k, long long at) {
    long long s = tree[k].l, t = tree[k].r;
    long long mid = (s + t) / 2;

    if (l&lt;=s &amp;&amp; t&lt;=r) {
        tree[k].f += at;
        tree[k].w += at * (t - s + 1);
        tree[k].mod();
        return;
    }

    down(k);
    if (l &lt;= mid) add(l, r, 2*k, at);
    if (r &gt;= mid + 1) add(l, r, 2*k+1, at);

    tree[k].w = tree[2*k].w + tree[2*k+1].w;
    tree[k].mod();
}

long long get(long long l, long long r, long long k) {
    long long s = tree[k].l, t = tree[k].r, sum = 0;
    long long mid = (s + t) / 2;

    if (l&lt;=s &amp;&amp; t&lt;=r) {
        return tree[k].w;
    }

    down(k);
    if (l &lt;= mid) sum += get(l, r, 2*k);
    sum %= p;
    if (r &gt;= mid + 1) sum += get(l, r, 2*k+1);
    return sum % p;
}

int main() {
    n = read(), m = read(), p = read();
    build(1, n, 1);

    while (m--) {
        d = read(), x = read(), y = read();
        if (d == 1) {
            c = read();
            cheng(x, y, 1, c);
        }
        else if (d == 2) {
            at = read();
            add(x, y, 1, at);
        }
        else printf(&quot;%lld\n&quot;, get(x, y, 1));
    }
    return 0;
}</code></pre>
<p>:::warning ğŸš¨ æ³¨æ„ %}</p>
<p>mod åˆ«å¿˜äº†</p>
<p>add è¦ return
cheng è¦ return
build è¦ return</p>
<p>get è¦ down(k)
add è¦ down(k)
cheng è¦ down(k)</p>
<p>:::</p>
<p>[^0]: Banner from <a href="https://icons8.com/">Icons8</a>
[^1]: é¢˜ç›®æ¥æº <a href="https://www.luogu.com.cn/problem/P3373">ã€æ¨¡æ¿ã€‘çº¿æ®µæ ‘ 2 - æ´›è°·</a></p>
]]></content:encoded>
        </item>
    </channel>
</rss>